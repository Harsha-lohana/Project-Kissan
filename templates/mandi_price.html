<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìä Mandi Price Checker ‚Äì Project Kisan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f4f7f9;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2b5b2e;
      margin-bottom: 20px;
    }

    form {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      background: #ffffff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      max-width: 800px;
      margin: 0 auto 20px;
    }

    label {
      flex: 1 1 40%;
      display: flex;
      flex-direction: column;
      font-weight: 500;
    }

    input {
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    button {
      padding: 10px 20px;
      background: #2b5b2e;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
      align-self: center;
    }

    button:hover {
      background: #3d8142;
    }

    #results {
      max-width: 1000px;
      margin: 0 auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }

    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid #eee;
      font-size: 0.95rem;
    }

    th {
      background-color: #e1f5e6;
      text-align: left;
      font-weight: bold;
    }

    tr:hover {
      background: #f9f9f9;
    }

    .error {
      color: red;
      text-align: center;
      font-weight: bold;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      form {
        flex-direction: column;
      }

      label {
        flex: 1 1 100%;
      }

      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead {
        display: none;
      }

      tr {
        background: white;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        padding: 10px;
      }

      td {
        border: none;
        padding: 8px 0;
        font-size: 0.95rem;
      }

      td::before {
        content: attr(data-label);
        font-weight: bold;
        display: inline-block;
        width: 130px;
        color: #2b5b2e;
      }
    }
  </style>
</head>
<body>
  <h1>üåæ Daily Mandi Price (‡§Æ‡§Ç‡§°‡•Ä ‡§≠‡§æ‡§µ)</h1>

  <form id="filterForm">
    <label>‡§∞‡§æ‡§ú‡•ç‡§Ø (State)
      <input type="text" name="state" placeholder="e.g., Kerala" />
    </label>
    <label>‡§ú‡§º‡§ø‡§≤‡§æ (District)
      <input type="text" name="district" placeholder="e.g., Kannur" />
    </label>
    <label>‡§Æ‡§Ç‡§°‡•Ä (Market)
      <input type="text" name="market" placeholder="e.g., Irikkur" />
    </label>
    <label>‡§´‡§∏‡§≤ (Commodity)
      <input type="text" name="commodity" placeholder="e.g., Arecanut" />
    </label>
    <label>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ (Variety)
      <input type="text" name="variety" placeholder="e.g., Other" />
    </label>
    <label>‡§ó‡•ç‡§∞‡•á‡§° (Grade)
      <input type="text" name="grade" placeholder="e.g., FAQ" />
    </label>
    <br>
    <button type="submit">üîç ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡•á‡§Ç</button>
  </form>

  <div id="results"></div>

  <script>
    document.getElementById('filterForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const params = new URLSearchParams();
      for (const [key, value] of formData.entries()) {
        if (value.trim()) params.append(key, value.trim());
      }

      const responseDiv = document.getElementById('results');
      responseDiv.innerHTML = "<p style='text-align:center;'>‚è≥ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>";

      try {
        const res = await fetch(`/mandi-price?${params.toString()}`);
        const data = await res.json();

        if (data.error) {
          responseDiv.innerHTML = `<p class="error">‚ùå ${data.message}</p>`;
          return;
        }

        if (!data.records || data.records.length === 0) {
          responseDiv.innerHTML = `<p style='text-align:center;'>üòî ‡§ï‡•ã‡§à ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç‡•§</p>`;
          return;
        }

        let html = `
          <h2 style="text-align:center;">üìã ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</h2>
          <table>
            <thead>
              <tr>
                <th>‡§∞‡§æ‡§ú‡•ç‡§Ø</th>
                <th>‡§ú‡§º‡§ø‡§≤‡§æ</th>
                <th>‡§Æ‡§Ç‡§°‡•Ä</th>
                <th>‡§´‡§∏‡§≤</th>
                <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
                <th>‡§ó‡•ç‡§∞‡•á‡§°</th>
                <th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
                <th>‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‚Çπ</th>
                <th>‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‚Çπ</th>
                <th>‡§Æ‡•â‡§°‡§≤ ‚Çπ</th>
              </tr>
            </thead>
            <tbody>
        `;

        data.records.forEach(item => {
          html += `
            <tr>
              <td data-label="‡§∞‡§æ‡§ú‡•ç‡§Ø">${item.state}</td>
              <td data-label="‡§ú‡§º‡§ø‡§≤‡§æ">${item.district}</td>
              <td data-label="‡§Æ‡§Ç‡§°‡•Ä">${item.market}</td>
              <td data-label="‡§´‡§∏‡§≤">${item.commodity}</td>
              <td data-label="‡§™‡•ç‡§∞‡§ï‡§æ‡§∞">${item.variety}</td>
              <td data-label="‡§ó‡•ç‡§∞‡•á‡§°">${item.grade}</td>
              <td data-label="‡§§‡§æ‡§∞‡•Ä‡§ñ">${item.arrival_date}</td>
              <td data-label="‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ ‚Çπ">‚Çπ${item.min_price}</td>
              <td data-label="‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‚Çπ">‚Çπ${item.max_price}</td>
              <td data-label="‡§Æ‡•â‡§°‡§≤ ‚Çπ">‚Çπ${item.modal_price}</td>
            </tr>
          `;
        });

        html += `</tbody></table>`;
        responseDiv.innerHTML = html;

      } catch (err) {
        console.error(err);
        responseDiv.innerHTML = `<p class="error">‚ùå ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§™‡§æ‡§Ø‡§æ‡•§</p>`;
      }
    });
  </script>
</body>
</html>
